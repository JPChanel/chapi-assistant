<Window x:Class="Chapi.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:Chapi"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:diffPlex="clr-namespace:DiffPlex.Wpf.Controls;assembly=DiffPlex.Wpf"
        mc:Ignorable="d"
        Title="Chapi Assistance"
        Height="600"
        Width="750"
        MinWidth="650"
        MinHeight="300"
        WindowStartupLocation="CenterScreen"
        TextElement.Foreground="{DynamicResource MaterialDesignBody}"
        Background="{DynamicResource MaterialDesignPaper}"
        FontFamily="Times New Roman"
        Closing="Window_Closing" Loaded="Window_Loaded">

    <materialDesign:DialogHost x:Name="GlobalDialogHost" Identifier="RootDialog">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <materialDesign:ColorZone x:Name="HeaderZone" Grid.Row="0"  BorderBrush="{DynamicResource MaterialDesignDivider}" BorderThickness="0,0,0,1"   Padding="15"  Mode="Dark" Foreground="{StaticResource HeaderForeground}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- 1. LOGO / MENÚ (Columna 0, Ocupa 2 Filas) -->
                    <StackPanel Grid.Row="0" Grid.Column="0" Grid.RowSpan="2" VerticalAlignment="Center" HorizontalAlignment="Left"  Margin="0,0,0,0">
                        <Button x:Name="LogoButton" Click="LogoButton_Click" Style="{StaticResource MaterialDesignToolButton}" ToolTip="Menú Principal Chapi (Utilidades API)" Height="76" Width="95"  Background="Transparent"  BorderThickness="0">
                            <StackPanel Orientation="Vertical" VerticalAlignment="Center" HorizontalAlignment="Center">
                                <Image Source="/Chapi;component/Image/logo.png"
                                       Width="45"
                                       Height="45"
                                       Stretch="Uniform"
                                       HorizontalAlignment="Center"/>
                                <TextBlock Text="Ninja"
                                           Margin="0,4,0,0"
                                           FontWeight="Bold"
                                           FontSize="14"
                                           VerticalAlignment="Center"
                                           HorizontalAlignment="Center"
                                           Foreground="White"/>
                            </StackPanel>
                     
                        </Button>
                        
                    </StackPanel>

                    <!-- 2. SELECTORES DE GIT (Columna 1, Ocupa 2 Filas, Centrado) -->
                    <StackPanel Grid.Row="0"  Grid.Column="1"  Grid.RowSpan="2"  VerticalAlignment="Top"  HorizontalAlignment="Stretch"  Margin="10,0,10,0">
                        <StackPanel Orientation="Vertical" HorizontalAlignment="Stretch">
                            <Border BorderBrush="{DynamicResource MaterialDesignDivider}"  BorderThickness="1" CornerRadius="2" Margin="0,5,0,5">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <ComboBox x:Name="ProjectsComboBox"
                                      Grid.Column="0"
                                      Width="Auto"
                                      HorizontalAlignment="Stretch"
                                      materialDesign:HintAssist.Hint="Seleccionar o Buscar Proyecto"
                                      materialDesign:HintAssist.Foreground="Orange" materialDesign:HintAssist.Background="{Binding Background, ElementName=HeaderZone}" Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                      SelectionChanged="ProjectsComboBox_SelectionChanged"
                                      IsEditable="True"
                                      IsTextSearchEnabled="True"
                                      TextSearch.TextPath="Name">

                                        <ComboBox.ContextMenu>
                                            <ContextMenu>
                                                <MenuItem Header="Clonar Nuevo Repositorio..." 
                                                    Click="CloneProject_Click" 
                                                    CommandParameter="{Binding PlacementTarget.SelectedItem.FullPath,
                                                    RelativeSource={RelativeSource AncestorType=ContextMenu}}">
                                                    <MenuItem.Icon>
                                                        <materialDesign:PackIcon Kind="Add" />
                                                    </MenuItem.Icon>
                                                </MenuItem>
                                                <MenuItem Header="Agregar Repositorio Existente..." 
                                                    Click="SelectProjectMenu_Click" 
                                                    CommandParameter="{Binding PlacementTarget.SelectedItem.FullPath, 
                                                    RelativeSource={RelativeSource AncestorType=ContextMenu}}">
                                                    <MenuItem.Icon>
                                                        <materialDesign:PackIcon Kind="FolderAdd" />
                                                    </MenuItem.Icon>
                                                </MenuItem>
                                                
                                            </ContextMenu>
                                        </ComboBox.ContextMenu>

                                        <ComboBox.ItemTemplate>
                                            <DataTemplate>
                                                <Grid Background="Transparent">
            
                <Grid.ContextMenu>
                    <ContextMenu>
                        <MenuItem Header="Abrir en Visual Studio" 
                                  Click="ProjectMenuItem_OpenVisualStudio_Click" 
                                  CommandParameter="{Binding FullPath}">
                            <MenuItem.Icon>
                                <materialDesign:PackIcon Kind="VisualStudio" />
                            </MenuItem.Icon>
                        </MenuItem>
                        <MenuItem Header="Abrir en VS Code" 
                                  Click="ProjectMenuItem_OpenVSCode_Click" 
                                  CommandParameter="{Binding FullPath}">
                            <MenuItem.Icon>
                                <materialDesign:PackIcon Kind="MicrosoftVisualStudioCode" />
                            </MenuItem.Icon>
                        </MenuItem>
                        <MenuItem Header="Mostrar en Explorador" 
                                  Click="ProjectMenuItem_OpenExplorer_Click" 
                                  CommandParameter="{Binding FullPath}">
                            <MenuItem.Icon>
                                <materialDesign:PackIcon Kind="FolderOpenOutline" />
                            </MenuItem.Icon>
                        </MenuItem>
                        <MenuItem Header="Abrir en Símbolo del sistema" 
                                  Click="ProjectMenuItem_OpenCmd_Click" 
                                  CommandParameter="{Binding FullPath}">
                            <MenuItem.Icon>
                                <materialDesign:PackIcon Kind="Console" />
                            </MenuItem.Icon>
                        </MenuItem>
                        <Separator />
                        <MenuItem Header="Remover de la lista" 
                                   Click="ProjectMenuItem_Remove_Click" 
                                   CommandParameter="{Binding FullPath}" 
                                   Foreground="Red">
                            <MenuItem.Icon>
                                <materialDesign:PackIcon Kind="DeleteOutline" Foreground="Red" />
                            </MenuItem.Icon>
                        </MenuItem>
                    </ContextMenu>
                </Grid.ContextMenu>
                                                <StackPanel Orientation="Horizontal">
                                                        <materialDesign:PackIcon Kind="{Binding Icon}" Margin="0,0,8,0"/>
                                                        <TextBlock Text="{Binding Name}"/>
                                                    </StackPanel>
                                                </Grid>
                                            </DataTemplate>
                                        </ComboBox.ItemTemplate>
                                    </ComboBox>
                                   
                                </Grid>
                            </Border>

                            <!-- Selector de Rama -->
                            <ComboBox x:Name="BranchesComboBox"
                                          VerticalAlignment="Center"
                                          HorizontalAlignment="Stretch"
                                          materialDesign:HintAssist.Hint="Seleccionar Rama"
                                          materialDesign:HintAssist.Foreground="Orange" materialDesign:HintAssist.Background="{Binding Background, ElementName=HeaderZone}" 
                                      Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                     SelectionChanged="BranchesComboBox_SelectionChanged" HorizontalContentAlignment="Stretch">

                                <ComboBox.ItemTemplate>
                                    <DataTemplate >
                                        <Grid Background="Transparent">
                                            <StackPanel Orientation="Horizontal"  >
                                                <materialDesign:PackIcon Kind="SourceBranch" Margin="0,0,8,0"/>
                                                <TextBlock Text="{Binding}"/>
                                            </StackPanel>

                                            <Grid.ContextMenu>
                                                <ContextMenu>
                                                    <MenuItem Header="Eliminar Rama..."
                                                          Click="Branch_Delete_Click"                                  
                                                          CommandParameter="{Binding}"                                  
                                                          Foreground="Red">
                                                        <MenuItem.Icon>
                                                            <materialDesign:PackIcon Kind="SourceBranchRemove" Foreground="Red"/>
                                                        </MenuItem.Icon>
                                                    </MenuItem>
                                                </ContextMenu>
                                            </Grid.ContextMenu>
                                        </Grid>
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>

                        </StackPanel>
                    </StackPanel>
                 
                    <StackPanel Grid.Row="0" Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Top">

                        <ComboBox x:Name="GitActionsComboBox"
                              Height="47"
                              Width="160" SelectedIndex="0"
                              VerticalAlignment="Center"
                              Style="{StaticResource MaterialDesignOutlinedComboBox}"
                              SelectionChanged="GitActionsComboBox_SelectionChanged"
                              ToolTip="Ejecutar una acción de Git"
                              Margin="0,6,0,0" 
                                  PreviewMouseLeftButtonDown="GitActionsComboBox_PreviewMouseLeftButtonDown"
          PreviewMouseRightButtonUp="GitActionsComboBox_PreviewMouseRightButtonUp">

                            <ComboBox.Items>

                                <ComboBoxItem x:Name="DefaultGitActionItem" Padding="10,5" >
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon x:Name="DefaultGitActionIcon" Kind="Refresh" Margin="0,0,8,0" Width="16" Height="16"/>
                                        <TextBlock x:Name="DefaultGitActionText" Text="Fetch Origin"/>
                                    </StackPanel>
                                </ComboBoxItem>

                                <ComboBoxItem x:Name="PullGitActionItem" Padding="10,5">
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="CloudDownloadOutline" Margin="0,0,8,0" Width="16" Height="16"/>
                                        <TextBlock x:Name="PullGitActionText" Text="Pull Origin"/>
                                    </StackPanel>
                                </ComboBoxItem>

                                <ComboBoxItem x:Name="PushGitActionItem" Padding="10,5">
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="CloudUploadOutline" Margin="0,0,8,0" Width="16" Height="16"/>
                                        <TextBlock x:Name="PushGitActionText" Text="Push Origin"/>
                                    </StackPanel>
                                </ComboBoxItem>

                                <ComboBoxItem x:Name="FetchGitActionItem" Padding="10,5">
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="Refresh" Margin="0,0,8,0" Width="16" Height="16"/>
                                        <TextBlock Text="Fetch Origin (Forzar)"/>
                                    </StackPanel>
                                </ComboBoxItem>

                            </ComboBox.Items>
                        </ComboBox>
                    </StackPanel>

                    <!-- 4. ACCIONES GIT (Columna 2, Fila 1) -->
                    <StackPanel Grid.Row="1" Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,5,0,0">
                        <ComboBox x:Name="ModoAgenteComboBox"
                          Height="47"
                          Width="160"
                          SelectedIndex="0"
                          VerticalAlignment="Center"
                          Style="{StaticResource MaterialDesignOutlinedComboBox}"
                          SelectionChanged="ModoAgenteComboBox_SelectionChanged"
                          ToolTip="Selecciona el modo de operación del agente">

                            <ComboBox.Items>
                                <!-- Item neutro -->
                                <ComboBoxItem Padding="10,5">
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="AccountCog"
                                             Margin="0,0,8,0"
                                             Width="16"
                                             Height="16"/>
                                        <TextBlock Text="Modo Agente"/>
                                    </StackPanel>
                                </ComboBoxItem>

                                <!-- Opción Agregar Método -->
                                <ComboBoxItem x:Name="AddMethodItem" Padding="10,5">
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="RocketLaunchOutline"
                                             Margin="0,0,8,0"
                                             Width="16"
                                             Height="16"/>
                                        <TextBlock Text="Agregar Método"/>
                                    </StackPanel>
                                </ComboBoxItem>

                                <!-- Opción Rollback -->
                                <ComboBoxItem x:Name="RollbackItem" Padding="10,5">
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="History"
                                             Margin="0,0,8,0"
                                             Width="16"
                                             Height="16"/>
                                        <TextBlock Text="Rollback"/>
                                    </StackPanel>
                                </ComboBoxItem>
                                <ComboBoxItem x:Name="SqlGeneratorItem" Padding="10,5">
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="DatabaseSearch"
                                         Margin="0,0,8,0"
                                         Width="16"
                                         Height="16"/>
                                        <TextBlock Text="Generar SQL"/>
                                    </StackPanel>
                                </ComboBoxItem>
                            </ComboBox.Items>
                        </ComboBox>
                    </StackPanel>
                </Grid>
            </materialDesign:ColorZone>

            <!-- ********************************************** -->
            <!-- 🗂️ NAVEGACIÓN (TABS) (Fila 1) -->
            <!-- ********************************************** -->
            <materialDesign:ColorZone Grid.Row="1" Mode="Standard" Padding="0">
                <TabControl x:Name="GitTabs"
                            Style="{StaticResource MaterialDesignTabControl}"
                            materialDesign:ColorZoneAssist.Mode="Light"  HorizontalContentAlignment="Left" BorderBrush="{DynamicResource PrimaryHueMidBrush}"
                            SelectionChanged="GitTabs_SelectionChanged">

                    <TabItem Header="Asistente" x:Name="AssistantTab">
                        <TabItem.HeaderTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" Margin="10,5">
                                    <materialDesign:PackIcon Kind="RobotHappy" Margin="0,0,8,0"/>
                                    <TextBlock Text="{Binding}"/>
                                </StackPanel>
                            </DataTemplate>
                        </TabItem.HeaderTemplate>
                        <!-- Contenido del Asistente (Chat) -->
                        <Grid>
                            <ScrollViewer x:Name="ChatScrollViewer"
                                          VerticalScrollBarVisibility="Auto"
                                          Padding="8">
                                <ItemsControl x:Name="MessagesItemsControl" ItemsSource="{Binding Messages}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Grid Margin="16,5">
                                                <Grid.Style>
                                                    <Style TargetType="Grid">
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding Author}" Value="User">
                                                                <Setter Property="HorizontalAlignment" Value="Right"/>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding Author}" Value="Assistant">
                                                                <Setter Property="HorizontalAlignment" Value="Left"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Grid.Style>
                                                <materialDesign:Card Padding="10">
                                                    <StackPanel>
                                                        <TextBlock Text="{Binding Author}" FontWeight="Bold"/>
                                                        <TextBox Text="{Binding Text}"
                                                                 TextWrapping="Wrap"
                                                                 IsReadOnly="True"
                                                                 BorderThickness="0"
                                                                 Background="Transparent"
                                                                 FontSize="14"
                                                                 VerticalScrollBarVisibility="Disabled"/>
                                                        <TextBlock Text="{Binding Timestamp}"
                                                                   FontSize="10"
                                                                   HorizontalAlignment="Right"
                                                                   Opacity="0.7"/>
                                                    </StackPanel>
                                                </materialDesign:Card>
                                            </Grid>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </ScrollViewer>
                        </Grid>
                    </TabItem>

                    <TabItem x:Name="ChangesTab">
                        <TabItem.Header>
                            <StackPanel Orientation="Horizontal" Margin="10,5">
                                <materialDesign:PackIcon Kind="SourceCommit" Margin="0,0,8,0"/>
                                <TextBlock x:Name="ChangesTabHeader" Text="Cambios"/>
                            </StackPanel>
                        </TabItem.Header>

                        <Grid>

                            <StackPanel x:Name="GitMissingView" 
                    Visibility="Collapsed"
                    HorizontalAlignment="Center" 
                    VerticalAlignment="Center"
                    Margin="20">

                                <materialDesign:PackIcon Kind="GiftOff" 
                                     Width="80" Height="80" 
                                     HorizontalAlignment="Center" 
                                     Foreground="{DynamicResource MaterialDesignCheckBoxDisabled}"/>

                                <TextBlock Text="Git no se encuentra" 
                       Style="{StaticResource MaterialDesignHeadline5TextBlock}" 
                       HorizontalAlignment="Center" 
                       Margin="0,16,0,0"/>

                                <TextBlock Text="Chapi necesita Git para rastrear cambios, ver el historial y gestionar commits. Parece que no está instalado o no se agregó al PATH del sistema."
                       Style="{StaticResource MaterialDesignBody1TextBlock}"
                       TextWrapping="Wrap" 
                       TextAlignment="Center"
                       MaxWidth="500" 
                       Margin="0,10,0,20"/>

                                <Button x:Name="btnInstallGit" 
                    Content="Descargar e Instalar Git"
                    Click="btnInstallGit_Click"
                    Style="{StaticResource MaterialDesignRaisedButton}"
                    HorizontalAlignment="Center"
                    materialDesign:ButtonAssist.CornerRadius="6"/>

                                <Button x:Name="btnRefreshGitCheck" 
                    Content="Volver a Comprobar"
                    Click="btnRefreshGitCheck_Click"
                    Style="{StaticResource MaterialDesignFlatButton}"
                    HorizontalAlignment="Center" 
                    Margin="0,10,0,0"/>
                            </StackPanel>

                            <Grid x:Name="GitControlsView" 
              Visibility="Collapsed">

                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="0.4*" MinWidth="250"/>
                                    <ColumnDefinition Width="0.6*"/>
                                </Grid.ColumnDefinitions>

                                <Grid Grid.Column="0">

                                    <DockPanel x:Name="NormalChangesView" 
                           Margin="5" 
                           LastChildFill="True" 
                           VerticalAlignment="Stretch"  
                           HorizontalAlignment="Stretch">

                                        <Border DockPanel.Dock="Top"
                            BorderBrush="{DynamicResource MaterialDesignDivider}"
                            BorderThickness="0,0,0,1"
                            Padding="8,5">
                                            <Border.ContextMenu>
                                                <ContextMenu>
                                                    <MenuItem Header="Stash Todos los Cambios..." Click="StashAllChangesMenuItem_Click">
                                                        <MenuItem.Icon>
                                                            <materialDesign:PackIcon Kind="ArchiveArrowDownOutline"/>
                                                        </MenuItem.Icon>
                                                    </MenuItem>
                                                    <MenuItem Header="Descartar Todos los Cambios..." Click="DiscardAllChangesMenuItem_Click" Foreground="Red">
                                                        <MenuItem.Icon>
                                                            <materialDesign:PackIcon Kind="UndoVariant" Foreground="Red"/>
                                                        </MenuItem.Icon>
                                                    </MenuItem>
                                                </ContextMenu>
                                            </Border.ContextMenu>
                                            <CheckBox x:Name="SelectAllCheckBox"
                                  Content="Seleccionar Todos"
                                  Checked="SelectAllCheckBox_Checked"
                                  Unchecked="SelectAllCheckBox_Unchecked"/>
                                        </Border>

                                        <materialDesign:Card DockPanel.Dock="Bottom" Padding="10" Margin="0,5,0,0" >
                                            <StackPanel>
                                                <TextBox x:Name="txtCommitSummary"
                                     materialDesign:HintAssist.Hint="Resumen del commit"
                                     Margin="0,0,0,10"
                                     Style="{StaticResource MaterialDesignOutlinedTextBox}"/>

                                                <TextBox x:Name="txtCommitDescription"
                                     materialDesign:HintAssist.Hint="Descripción (opcional)"
                                     MinHeight="80"
                                     TextWrapping="Wrap"
                                     AcceptsReturn="True"
                                     VerticalScrollBarVisibility="Auto"
                                     Margin="0,0,0,10"
                                     Style="{StaticResource MaterialDesignOutlinedTextBox}"/>

                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>

                                                    <Button x:Name="btnCommit"
                                        Grid.Column="0"
                                        Content="Commit"
                                        Click="btnCommit_Click"
                                        Style="{StaticResource MaterialDesignRaisedButton}"/>

                                                    <Button x:Name="btnGitCommitIA"
                                        Grid.Column="1"
                                        ToolTip="Generar commit con IA"
                                        Click="btnGitCommit_Click"
                                        Style="{StaticResource MaterialDesignIconButton}"
                                        Margin="5,0,0,0">
                                                        <materialDesign:PackIcon Kind="RobotAngryOutline" />
                                                    </Button>
                                                </Grid>
                                            </StackPanel>
                                        </materialDesign:Card>

                                        <Expander x:Name="StashExpander"
                              DockPanel.Dock="Bottom"
                              Margin="0,5,0,0"
                              materialDesign:ExpanderAssist.HeaderBackground="{DynamicResource MaterialDesignPaper}"
                              Visibility="Collapsed"
                              BorderBrush="{DynamicResource MaterialDesignDivider}"
                              BorderThickness="0,1,0,0">
                                            <Expander.Header>
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>
                                                    <TextBlock x:Name="StashExpanderHeader"
                                           Text="Stashed Changes (0)"
                                           Grid.Column="0"
                                           FontWeight="Bold"
                                           VerticalAlignment="Center"
                                           Margin="10,0"/>
                                                    <Button x:Name="DiscardAllStashesButton"
                                        Grid.Column="1"
                                        Content="Descartar Todo"
                                        Style="{StaticResource MaterialDesignFlatButton}"
                                        Click="DiscardAllStashesButton_Click"
                                        ToolTip="Elimina permanentemente TODOS los stashes"
                                        Foreground="Red"
                                        Margin="0,0,10,0"/>
                                                </Grid>
                                            </Expander.Header>
                                            <ListView x:Name="StashListView"
                                  MaxHeight="150"
                                  ScrollViewer.VerticalScrollBarVisibility="Auto"
                                  SelectionChanged="StashListView_SelectionChanged">
                                                <ListView.ItemTemplate>
                                                    <DataTemplate>
                                                        <Grid Margin="5" HorizontalAlignment="Stretch">
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="Auto"/>
                                                                <ColumnDefinition Width="Auto"/>
                                                            </Grid.ColumnDefinitions>
                                                            <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                                                <TextBlock Text="{Binding Message}" FontWeight="SemiBold"/>
                                                                <TextBlock Text="{Binding Branch, StringFormat='En {0}'}" Foreground="Gray" FontSize="11"/>
                                                            </StackPanel>
                                                            <Button x:Name="RestoreStashItemButton"
                                                Grid.Column="1"
                                                Content="Restaurar"
                                                Style="{StaticResource MaterialDesignFlatButton}"
                                                Foreground="DeepSkyBlue"
                                                Click="RestoreStashItemButton_Click"
                                                CommandParameter="{Binding}"
                                                Margin="10,0,5,0"/>
                                                            <Button x:Name="DiscardStashItemButton"
                                                Grid.Column="2"
                                                Content="Descartar"
                                                Style="{StaticResource MaterialDesignFlatButton}"
                                                Click="DiscardStashItemButton_Click"
                                                CommandParameter="{Binding}"
                                                Foreground="Red"/>
                                                        </Grid>
                                                    </DataTemplate>
                                                </ListView.ItemTemplate>
                                            </ListView>
                                        </Expander>

                                        <ListView x:Name="ChangesListView" 
                              VerticalAlignment="Stretch"
                              VerticalContentAlignment="Stretch"
                              HorizontalContentAlignment="Stretch"
                              Margin="0,0,0,5" 
                              SelectionChanged="ChangesListView_SelectionChanged">
                                            <ListView.ItemTemplate>
                                                <DataTemplate>
                                                    <Grid Margin="0,2" >
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="Auto"/>
                                                            <ColumnDefinition Width="*"/>
                                                            <ColumnDefinition Width="Auto"/>
                                                        </Grid.ColumnDefinitions>

                                                        <CheckBox Grid.Column="0"
                                              IsChecked="{Binding IsSelected}"
                                              VerticalAlignment="Center"
                                              Margin="0,0,10,0"
                                              Click="CommitCheckbox_Click"/>

                                                        <TextBlock Grid.Column="1"
                                               Text="{Binding FilePath}"                                           
                                               VerticalAlignment="Center"
                                               TextTrimming="CharacterEllipsis"
                                               Margin="0,0,10,0"/>

                                                        <materialDesign:PackIcon Grid.Column="2"
                                                             Kind="{Binding Icon}"
                                                             Foreground="{Binding Color}"
                                                             ToolTip="{Binding Status}"
                                                             VerticalAlignment="Center"
                                                             HorizontalAlignment="Right"
                                                             Margin="0,0,5,0"/>

                                                        <Grid.ContextMenu>
                                                            <ContextMenu>
                                                                <MenuItem Header="Stash Cambios Seleccionados"
                                                      Click="StashSelectedMenuItem_Click">
                                                                    <MenuItem.Icon>
                                                                        <materialDesign:PackIcon Kind="ArchiveArrowDownOutline"/>
                                                                    </MenuItem.Icon>
                                                                </MenuItem>
                                                                <MenuItem Header="Descartar Cambios"
                                                      Click="DiscardChangesMenuItem_Click"
                                                      CommandParameter="{Binding}">
                                                                    <MenuItem.Icon>
                                                                        <materialDesign:PackIcon Kind="UndoVariant" Foreground="Red"/>
                                                                    </MenuItem.Icon>
                                                                </MenuItem>
                                                            </ContextMenu>
                                                        </Grid.ContextMenu>
                                                    </Grid>
                                                </DataTemplate>
                                            </ListView.ItemTemplate>
                                        </ListView>
                                    </DockPanel>

                                    <DockPanel x:Name="StashedChangesView" 
                           Margin="5" 
                           LastChildFill="True" 
                           Visibility="Collapsed">

                                        <Border DockPanel.Dock="Top"
                            Background="{DynamicResource MaterialDesignPaper}"
                            BorderBrush="{DynamicResource MaterialDesignDivider}"
                            BorderThickness="0,0,0,1"
                            Padding="10">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <Button x:Name="StashView_RestoreButton"
                                    Grid.Column="0"
                                    Content="Restaurar"
                                    Click="StashView_RestoreButton_Click"
                                    Style="{StaticResource MaterialDesignRaisedButton}"/>

                                                <Button x:Name="StashView_DiscardButton"
                                    Grid.Column="1"
                                    Content="Descartar"
                                    Click="StashView_DiscardButton_Click"
                                    Style="{StaticResource MaterialDesignOutlinedButton}"
                                    Foreground="Red"
                                    Margin="10,0,0,0"/>

                                                <TextBlock x:Name="StashView_Header"
                                       Grid.Column="2"
                                       Text="Stash de 10 archivos"
                                       VerticalAlignment="Center"
                                       HorizontalAlignment="Center"
                                       FontWeight="Bold"/>

                                                <Button x:Name="StashView_BackButton"
                                    Grid.Column="3"
                                    Content="← Volver"
                                    Click="StashView_BackButton_Click"
                                    Style="{StaticResource MaterialDesignFlatButton}"
                                    HorizontalAlignment="Right"/>
                                            </Grid>
                                        </Border>

                                        <ListView x:Name="StashFilesListView"
                              VerticalAlignment="Stretch"
                              VerticalContentAlignment="Stretch"
                              Margin="0,0,0,5"
                              SelectionChanged="StashFilesListView_SelectionChanged">
                                            <ListView.ItemTemplate>
                                                <DataTemplate>
                                                    <Grid Margin="0,2">
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="*"/>
                                                            <ColumnDefinition Width="Auto"/>
                                                        </Grid.ColumnDefinitions>

                                                        <TextBlock Grid.Column="0"
                                               Text="{Binding FilePath}"
                                               ToolTip="{Binding Status}"
                                               VerticalAlignment="Center"
                                               TextTrimming="CharacterEllipsis"
                                               Margin="0,0,10,0"/>

                                                        <materialDesign:PackIcon Grid.Column="1"
                                                             Kind="{Binding Icon}"
                                                             Foreground="{Binding Color}"
                                                             VerticalAlignment="Center"
                                                             HorizontalAlignment="Right"
                                                             Margin="0,0,5,0"/>
                                                    </Grid>
                                                </DataTemplate>
                                            </ListView.ItemTemplate>
                                        </ListView>
                                    </DockPanel>
                                </Grid>

                                <Border Grid.Column="1" 
                    BorderBrush="{DynamicResource MaterialDesignDivider}" 
                    BorderThickness="1,0,0,0" 
                    Margin="5,0,0,0"
                    Background="#2E2E2E">
                                    <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto">
                                        <ItemsControl x:Name="DiffLinesItemsControl" 
                                  FontFamily="Consolas" 
                                  FontSize="12"
                                  VirtualizingStackPanel.IsVirtualizing="True"
                                  VirtualizingStackPanel.VirtualizationMode="Recycling">

                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <Grid ContextMenuOpening="DiffLine_ContextMenuOpening">
                                                        <Grid.ContextMenu>
                                                            <ContextMenu>
                                                                <MenuItem x:Name="DiffLineMenu_OpenFile"
                                                      Header="Abrir en VS Code"
                                                      Click="DiffLineMenu_OpenFile_Click"
                                                      FontWeight="Bold">
                                                                    <MenuItem.Icon>
                                                                        <materialDesign:PackIcon Kind="MicrosoftVisualStudioCode" />
                                                                    </MenuItem.Icon>
                                                                </MenuItem>
                                                            </ContextMenu>
                                                        </Grid.ContextMenu>

                                                        <Grid.Style>
                                                            <Style TargetType="Grid">
                                                                <Setter Property="Background" Value="Transparent"/>
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding Type}" Value="Inserted">
                                                                        <Setter Property="Background" Value="#104010"/>
                                                                    </DataTrigger>
                                                                    <DataTrigger Binding="{Binding Type}" Value="Deleted">
                                                                        <Setter Property="Background" Value="#401010"/>
                                                                    </DataTrigger>
                                                                    <DataTrigger Binding="{Binding Type}" Value="Imaginary">
                                                                        <Setter Property="Background" Value="#222"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </Grid.Style>

                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="35"/>
                                                            <ColumnDefinition Width="35"/>
                                                            <ColumnDefinition Width="*"/>
                                                        </Grid.ColumnDefinitions>

                                                        <TextBlock Grid.Column="0" Text="{Binding Position}" Foreground="#888" Padding="5,0" HorizontalAlignment="Right">
                                                            <TextBlock.Style>
                                                                <Style TargetType="TextBlock">
                                                                    <Setter Property="Visibility" Value="Visible"/>
                                                                    <Style.Triggers>
                                                                        <DataTrigger Binding="{Binding Type}" Value="Inserted">
                                                                            <Setter Property="Visibility" Value="Hidden"/>
                                                                        </DataTrigger>
                                                                        <DataTrigger Binding="{Binding Type}" Value="Imaginary">
                                                                            <Setter Property="Visibility" Value="Hidden"/>
                                                                        </DataTrigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </TextBlock.Style>
                                                        </TextBlock>

                                                        <TextBlock Grid.Column="1" Text="{Binding Position}" Foreground="#888" Padding="5,0" HorizontalAlignment="Right">
                                                            <TextBlock.Style>
                                                                <Style TargetType="TextBlock">
                                                                    <Setter Property="Visibility" Value="Visible"/>
                                                                    <Style.Triggers>
                                                                        <DataTrigger Binding="{Binding Type}" Value="Deleted">
                                                                            <Setter Property="Visibility" Value="Hidden"/>
                                                                        </DataTrigger>
                                                                        <DataTrigger Binding="{Binding Type}" Value="Imaginary">
                                                                            <Setter Property="Visibility" Value="Hidden"/>
                                                                        </DataTrigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </TextBlock.Style>
                                                        </TextBlock>

                                                        <TextBlock Grid.Column="2" Text="{Binding Text}" TextWrapping="NoWrap" Foreground="#DCDCDC" Padding="10,0,0,0">
                                                            <TextBlock.Style>
                                                                <Style TargetType="TextBlock">
                                                                    <Setter Property="Text" Value="{Binding Text, StringFormat='  {0}'}"/>
                                                                    <Style.Triggers>
                                                                        <DataTrigger Binding="{Binding Type}" Value="Inserted">
                                                                            <Setter Property="Foreground" Value="#ADFFAD"/>
                                                                            <Setter Property="Text" Value="{Binding Text, StringFormat='+ {0}'}"/>
                                                                        </DataTrigger>
                                                                        <DataTrigger Binding="{Binding Type}" Value="Deleted">
                                                                            <Setter Property="Foreground" Value="#FFADAD"/>
                                                                            <Setter Property="Text" Value="{Binding Text, StringFormat='- {0}'}"/>
                                                                        </DataTrigger>
                                                                        <DataTrigger Binding="{Binding Type}" Value="Unchanged">
                                                                            <Setter Property="Foreground" Value="#999"/>
                                                                        </DataTrigger>
                                                                        <DataTrigger Binding="{Binding Type}" Value="Imaginary">
                                                                            <Setter Property="Text" Value="..."/>
                                                                            <Setter Property="Foreground" Value="#888"/>
                                                                        </DataTrigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </TextBlock.Style>
                                                        </TextBlock>
                                                    </Grid>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </ScrollViewer>
                                </Border>
                            </Grid>
                        </Grid>
                    </TabItem>
                    <TabItem x:Name="HistoryTab" Header="Historial">
                        <TabItem.HeaderTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" Margin="10,5">
                                    <materialDesign:PackIcon Kind="History" Margin="0,0,8,0"/>
                                    <TextBlock Text="{Binding}"/>
                                </StackPanel>
                            </DataTemplate>
                        </TabItem.HeaderTemplate>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="0.3*" MinWidth="200"/>
                                <ColumnDefinition Width="0.3*" MinWidth="200"/>
                                <ColumnDefinition Width="0.4*"/>
                            </Grid.ColumnDefinitions>

                            <Border Grid.Column="0" BorderBrush="{DynamicResource MaterialDesignDivider}" BorderThickness="0,0,1,0" >
                                <ListView x:Name="HistoryListView" 
                                SelectionChanged="HistoryListView_SelectionChanged"
                                HorizontalContentAlignment="Stretch">

                                    <ListView.ItemTemplate>
                                        <DataTemplate>
                                            <Grid Margin="5" 
                                                Background="Transparent" ContextMenuOpening="History_ContextMenu_Opening">

                                                <Grid.ContextMenu>
                                                    <ContextMenu>
                                                        <MenuItem x:Name="ResetSoftMenuItem"
                        Header="Deshacer Último Commit (Soft)"
                        Click="History_ResetSoft_Click">
                                                            <MenuItem.Icon>
                                                                <materialDesign:PackIcon Kind="Undo" Foreground="Orange"/>
                                                            </MenuItem.Icon>
                                                        </MenuItem>

                                                        <Separator />

                                                        <MenuItem Header="Create Branch from this Commit..."
                        Click="History_CreateBranch_Click"
                        CommandParameter="{Binding Hash}">
                                                            <MenuItem.Icon>
                                                                <materialDesign:PackIcon Kind="SourceBranch" Foreground="DeepSkyBlue"/>
                                                            </MenuItem.Icon>
                                                        </MenuItem>

                                                        <MenuItem Header="Create Tag from this Commit..."
                        Click="History_CreateTag_Click"
                        CommandParameter="{Binding Hash}">
                                                            <MenuItem.Icon>
                                                                <materialDesign:PackIcon Kind="TagPlus" Foreground="Gray"/>
                                                            </MenuItem.Icon>
                                                        </MenuItem>
                                                    </ContextMenu>
                                                </Grid.ContextMenu>

                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*" />
                                                    <ColumnDefinition Width="Auto" />
                                                </Grid.ColumnDefinitions>

                                                <StackPanel Grid.Column="0" VerticalAlignment="Center">

                                                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                        <TextBlock FontWeight="Bold">
                  <Run Text="Commit: "/>
                  <Run Text="{Binding Hash}" Foreground="Goldenrod"/>
                                                        </TextBlock>

                                                        <materialDesign:PackIcon Kind="ArrowUpCircleOutline" 
                                       Foreground="DeepSkyBlue" 
                                       Margin="8,0,0,0"
                                       VerticalAlignment="Center"
                                       ToolTip="Este commit no se ha subido (push)">
                                                            <materialDesign:PackIcon.Style>
                                                                <Style TargetType="materialDesign:PackIcon">
                                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                                    <Style.Triggers>
                                                                        <DataTrigger Binding="{Binding IsUnpushed}" Value="True">
                                                                            <Setter Property="Visibility" Value="Visible"/>
                                                                        </DataTrigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </materialDesign:PackIcon.Style>
                                                        </materialDesign:PackIcon>
                                                    </StackPanel>

                                                    <TextBlock>
              <Run Text="Autor: " FontWeight="SemiBold"/>
              <Run Text="{Binding Author}"/>
              <Run Text=" ("/>
              <Run Text="{Binding Date}" FontStyle="Italic"/>
              <Run Text=")"/>
                                                    </TextBlock>

                                                    <TextBlock Text="{Binding Message}" TextWrapping="Wrap" Margin="0,5,0,0"/>

                                                </StackPanel>

                                                <ItemsControl Grid.Column="1" 
                    ItemsSource="{Binding Tags}" 
                    VerticalAlignment="Center" 
                    HorizontalAlignment="Right"
                    Margin="10,0,0,0">

                                                    <ItemsControl.Style>
                                                        <Style TargetType="ItemsControl">
                                                            <Setter Property="Visibility" Value="Collapsed"/>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding HasTags}" Value="True">
                                                                    <Setter Property="Visibility" Value="Visible"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </ItemsControl.Style>
                                                    <ItemsControl.ItemsPanel>
                                                        <ItemsPanelTemplate>
                                                            <StackPanel Orientation="Vertical" HorizontalAlignment="Right"/>
                                                        </ItemsPanelTemplate>
                                                    </ItemsControl.ItemsPanel>
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <Border Background="Gray" CornerRadius="3" Margin="0,0,0,5" Padding="6,2">
                                                                <StackPanel Orientation="Horizontal">
                                                                    <materialDesign:PackIcon Kind="TagOutline" VerticalAlignment="Center" Margin="0,0,4,0" Height="12" Width="12"/>
                                                                    <TextBlock Text="{Binding}" FontSize="11" FontWeight="SemiBold" Foreground="#E0E0E0"/>
                                                                </StackPanel>
                                                            </Border>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>

                                            </Grid>
                                        </DataTemplate>
                                    </ListView.ItemTemplate>
                                </ListView>
                            </Border>

                            <Border Grid.Column="1" BorderBrush="{DynamicResource MaterialDesignDivider}" BorderThickness="0,0,1,0">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>

                                    <Border Grid.Row="0"
                                        x:Name="CommitSummaryHeader"
                                        Background="{DynamicResource MaterialDesignPaper}"
                                        BorderBrush="{DynamicResource MaterialDesignDivider}"
                                        BorderThickness="0,0,0,1"
                                        Padding="10"
                                        Visibility="Collapsed">
                                        <StackPanel>
                                            <TextBlock x:Name="CommitSummaryMessage" 
                                               FontWeight="Bold" 
                                               TextWrapping="Wrap"
                                               Text="feat: implementa búsqueda de firmantes"/>

                                            <TextBlock x:Name="CommitSummaryInfo" 
                                               Foreground="Gray" 
                                               FontSize="12"
                                               Text="Johan Chanel cometió 12ce0d4"/>

                                            <ScrollViewer MaxHeight="100" VerticalScrollBarVisibility="Auto" Margin="0,10,0,0">
                                                <TextBlock x:Name="CommitSummaryDescription"
                                                TextWrapping="Wrap"
                                                FontSize="11"
                                                Opacity="0.8"
                                                Text="Descripción larga del commit..."/>
                                            </ScrollViewer>
                                        </StackPanel>
                                    </Border>





                                    <ListView x:Name="HistoryFilesListView" Grid.Row="1"
                                  Margin="0"
                                  BorderThickness="0"
                                  SelectionChanged="HistoryFilesListView_SelectionChanged">
                                        <ListView.ItemTemplate>
                                            <DataTemplate>
                                                <StackPanel Orientation="Horizontal" Margin="5">
                                                    <materialDesign:PackIcon Kind="File" Margin="0,0,8,0" Foreground="Gray"/>
                                                    <TextBlock Text="{Binding}"/>
                                                </StackPanel>
                                            </DataTemplate>
                                        </ListView.ItemTemplate>
                                    </ListView>
                                </Grid>
                            </Border>

                            <Border Grid.Column="2" Background="#2E2E2E">
                                <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto">
                                    <ItemsControl x:Name="HistoryDiffLinesItemsControl" 
                              FontFamily="Consolas" 
                              FontSize="12"
                              VirtualizingStackPanel.IsVirtualizing="True"
                              VirtualizingStackPanel.VirtualizationMode="Recycling">

                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Grid>
                                                    <Grid.Style>
                                                        <Style TargetType="Grid">
                                                            <Setter Property="Background" Value="Transparent"/>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding Type}" Value="Inserted">
                                                                    <Setter Property="Background" Value="#104010"/>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding Type}" Value="Deleted">
                                                                    <Setter Property="Background" Value="#401010"/>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding Type}" Value="Imaginary">
                                                                    <Setter Property="Background" Value="#222"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </Grid.Style>

                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="35"/>
                                                        <ColumnDefinition Width="35"/>
                                                        <ColumnDefinition Width="*"/>
                                                    </Grid.ColumnDefinitions>

                                                    <TextBlock Grid.Column="0" Text="{Binding Position}" Foreground="#888" Padding="5,0" HorizontalAlignment="Right">
                                                        <TextBlock.Style>
                                                            <Style TargetType="TextBlock">
                                                                <Setter Property="Visibility" Value="Visible"/>
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding Type}" Value="Inserted">
                                                                        <Setter Property="Visibility" Value="Hidden"/>
                                                                    </DataTrigger>
                                                                    <DataTrigger Binding="{Binding Type}" Value="Imaginary">
                                                                        <Setter Property="Visibility" Value="Hidden"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </TextBlock.Style>
                                                    </TextBlock>

                                                    <TextBlock Grid.Column="1" Text="{Binding Position}" Foreground="#888" Padding="5,0" HorizontalAlignment="Right">
                                                        <TextBlock.Style>
                                                            <Style TargetType="TextBlock">
                                                                <Setter Property="Visibility" Value="Visible"/>
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding Type}" Value="Deleted">
                                                                        <Setter Property="Visibility" Value="Hidden"/>
                                                                    </DataTrigger>
                                                                    <DataTrigger Binding="{Binding Type}" Value="Imaginary">
                                                                        <Setter Property="Visibility" Value="Hidden"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </TextBlock.Style>
                                                    </TextBlock>

                                                    <TextBlock Grid.Column="2" Text="{Binding Text}" TextWrapping="NoWrap" Foreground="#DCDCDC" Padding="10,0,0,0">
                                                        <TextBlock.Style>
                                                            <Style TargetType="TextBlock">
                                                                <Setter Property="Text" Value="{Binding Text, StringFormat='  {0}'}"/>
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding Type}" Value="Inserted">
                                                                        <Setter Property="Foreground" Value="#ADFFAD"/>
                                                                        <Setter Property="Text" Value="{Binding Text, StringFormat='+ {0}'}"/>
                                                                    </DataTrigger>
                                                                    <DataTrigger Binding="{Binding Type}" Value="Deleted">
                                                                        <Setter Property="Foreground" Value="#FFADAD"/>
                                                                        <Setter Property="Text" Value="{Binding Text, StringFormat='- {0}'}"/>
                                                                    </DataTrigger>
                                                                    <DataTrigger Binding="{Binding Type}" Value="Unchanged">
                                                                        <Setter Property="Foreground" Value="#999"/>
                                                                    </DataTrigger>
                                                                    <DataTrigger Binding="{Binding Type}" Value="Imaginary">
                                                                        <Setter Property="Text" Value="..."/>
                                                                        <Setter Property="Foreground" Value="#888"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </TextBlock.Style>
                                                    </TextBlock>
                                                </Grid>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </ScrollViewer>
                            </Border>
                        </Grid>
                    </TabItem>
                    <TabItem x:Name="TagsTab" Header="Tags">
                        <TabItem.HeaderTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" Margin="10,5">
                                    <materialDesign:PackIcon Kind="Tag" Margin="0,0,8,0"/>
                                    <TextBlock Text="{Binding}"/>
                                </StackPanel>
                            </DataTemplate>
                        </TabItem.HeaderTemplate>

                        <Grid Margin="5">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <Button x:Name="btnCrearTag"
                    Grid.Row="0"
                    Content="Crear Nuevo Tag Commit Actual"
                    Click="btnCrearTag_Click"
                    HorizontalAlignment="Left"
                    Margin="5,5,0,10"
                    Style="{StaticResource MaterialDesignRaisedButton}"/>

                            <ListView x:Name="TagsListView" Grid.Row="1" Margin="5" HorizontalContentAlignment="Stretch" >
                                <ListView.ItemTemplate>
                                    <DataTemplate>
                                        <Grid Background="Transparent">

                                            <Grid.ContextMenu>
                                                <ContextMenu>
                                                    <MenuItem Header="Eliminar Tag..."
                                                      Click="DeleteTag_Click"
                                                      CommandParameter="{Binding}"
                                                      Foreground="Red">
                                                        <MenuItem.Icon>
                                                            <materialDesign:PackIcon Kind="TagRemoveOutline" Foreground="Red"/>
                                                        </MenuItem.Icon>
                                                    </MenuItem>
                                                </ContextMenu>
                                            </Grid.ContextMenu>

                                            <StackPanel Margin="5">
                                                <StackPanel Orientation="Horizontal">
                                                    <materialDesign:PackIcon Kind="TagOutline" Margin="0,0,10,0" VerticalAlignment="Center"/>
                                                    <TextBlock Text="{Binding TagName}" FontWeight="Bold" FontSize="16"/>
                                                    <TextBlock Text="{Binding TagMessage}" 
                                                       FontStyle="Italic" 
                                                       Margin="26,4,0,0" 
                                                       FontSize="12" 
                                                       Foreground="Gray"/>
                                                </StackPanel>

                                                <StackPanel Orientation="Horizontal" Margin="26,0,0,0">
                                                    <TextBlock Text="{Binding CommitHash}" 
                                                       FontFamily="Consolas" 
                                                       Foreground="Goldenrod" 
                                                       FontSize="12"/>
                                                    <TextBlock Text="{Binding CommitMessage}" Margin="10,0,0,0" FontSize="12"/>
                                                    <TextBlock Text="{Binding RelativeDate}" FontStyle="Italic" Margin="10,0,0,0" FontSize="12" Foreground="Gray"/>
                                                </StackPanel>
                                            </StackPanel>

                                        </Grid>
                                    </DataTemplate>
                                </ListView.ItemTemplate>
                            </ListView>
                        </Grid>
                    </TabItem>

                </TabControl>

            </materialDesign:ColorZone>
            <!-- Overlay de Carga -->
            <Grid x:Name="LoadingOverlay"
                  Grid.RowSpan="3"
                  Background="#66000000"
                  Visibility="Collapsed"
                  Panel.ZIndex="999"
                  HorizontalAlignment="Stretch"
                  VerticalAlignment="Stretch">
                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                    <ProgressBar Style="{StaticResource MaterialDesignCircularProgressBar}"
                                 IsIndeterminate="True"
                                 Width="36"
                                 Height="36"
                                 Foreground="White"/>
                    <TextBlock Text="Procesando..."
                               Foreground="White"
                               FontSize="13"
                               Margin="0,10,0,0"
                               HorizontalAlignment="Center"/>
                </StackPanel>
            </Grid>
        </Grid>
    </materialDesign:DialogHost>
</Window>

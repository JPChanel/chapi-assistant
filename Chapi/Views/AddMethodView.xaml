<Window x:Class="Chapi.Views.AddMethodView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        mc:Ignorable="d"
        Title="Agregar MÃ©todo"
        Width="850"
SizeToContent="Height" MaxHeight="800"
        MinWidth="750"
        WindowStartupLocation="CenterScreen"
        
        Background="#F9FBFD">

    <Grid  Margin="20"
      VerticalAlignment="Top"
      HorizontalAlignment="Stretch">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Header -->
            <RowDefinition Height="*"/>
            <!-- Contenido con Scroll -->
            <RowDefinition Height="Auto"/>
            <!-- Footer -->
        </Grid.RowDefinitions>

        <!-- ðŸ§± HEADER -->
        <Grid Grid.Row="0" Margin="0,0,0,16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <!-- TÃ­tulos -->
            <StackPanel Grid.Column="0" VerticalAlignment="Center">
                <TextBlock Text="ðŸš€ Agregar MÃ©todo"
                   FontSize="28"
                   FontWeight="SemiBold"
              
                   Margin="0,0,0,2"/>
                <TextBlock Text="Genera mÃ©todos automÃ¡ticamente con o sin asistencia de IA"
                   Foreground="#8899AA"
                   FontSize="13"
                   FontStyle="Italic"/>
            </StackPanel>

            <!-- Checkbox moderno -->
            <Border Grid.Column="1"
            CornerRadius="6"
            Background="#F5F8FF"
            Padding="10,6"
            VerticalAlignment="Center"
            Margin="8,0,0,0"
            BorderBrush="#D0E3FF"
            BorderThickness="1">
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <CheckBox x:Name="chkUseIA"
                      VerticalAlignment="Center"
                      Checked="chkUseIA_Checked"
                      Unchecked="chkUseIA_Unchecked">
                        <CheckBox.Content>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="ðŸ¤–"
                                   FontSize="16"
                                   Margin="0,0,6,0"/>
                                <TextBlock Text="Modo Avanzado (IA)"
                                   FontSize="14"
                                   FontWeight="SemiBold"
                                   Foreground="#2E8BFF"/>
                            </StackPanel>
                        </CheckBox.Content>
                    </CheckBox>
                </StackPanel>
            </Border>
        </Grid>

        <!-- ðŸ§­ CONTENIDO SCROLLEABLE -->
        <ScrollViewer Grid.Row="1"
              VerticalScrollBarVisibility="Auto"
              HorizontalScrollBarVisibility="Disabled"
              PanningMode="Both"
              CanContentScroll="True"
              ScrollViewer.IsDeferredScrollingEnabled="True">

            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- PANEL MANUAL -->
                <StackPanel x:Name="methotPanel" Margin="10" Grid.Row="0">
                    <Grid Margin="10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="15"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- ConfiguraciÃ³n BÃ¡sica -->
                        <GroupBox Header="ðŸ“‹ ConfiguraciÃ³n BÃ¡sica"
                                  Grid.Column="0"
                                  Margin="0,0,0,15"
                                  Style="{StaticResource MaterialDesignCardGroupBox}">
                            <StackPanel Margin="15">
                                <TextBox x:Name="txtModulo"
                                         materialDesign:HintAssist.Hint="Nombre del MÃ³dulo (ej: Producto)"
                                         Margin="0,0,0,10"
                                         FontSize="14"/>
                                <TextBox x:Name="txtMetodo"
                                         materialDesign:HintAssist.Hint="Nombre del MÃ©todo (opcional)"
                                         Margin="0,0,0,10"
                                         FontSize="14"/>
                                <ComboBox x:Name="cbobd"
                                          materialDesign:HintAssist.Hint="Base de Datos"
                                          FontSize="14">
                                    <ComboBoxItem Content="Postgres"/>
                                    <ComboBoxItem Content="Sybase"/>
                                </ComboBox>
                            </StackPanel>
                        </GroupBox>

                        <!-- Operaciones HTTP -->
                        <GroupBox Header="ðŸŒ Operaciones HTTP"
                                  Grid.Column="2"
                                  Style="{StaticResource MaterialDesignCardGroupBox}" Margin="0,0,0,15">
                            <StackPanel Margin="10">
                                <CheckBox x:Name="checkPost"
                                          Content="POST - Crear/Ejecutar"
                                          Margin="0,5"/>
                                <CheckBox x:Name="checkGet"
                                          Content="GET - BÃºsqueda/Listar (Search)"
                                          Margin="0,5"/>
                                <CheckBox x:Name="checkGetById"
                                          Content="GET by ID - Buscar por cÃ³digo (Find)"
                                          Margin="0,5"/>
                            </StackPanel>
                        </GroupBox>
                    </Grid>
                </StackPanel>

                <!-- PANEL IA -->
                <StackPanel x:Name="iaPanel" Margin="10" Grid.Row="1" Visibility="Collapsed">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- ðŸ§  Ayuda -->
                        <Border Grid.Row="0"
                                Background="#E3F2FD"
                                Padding="15"
                                CornerRadius="5"
                                Margin="10">
                            <StackPanel>
                                <TextBlock Text="ðŸ’¡ Â¿CÃ³mo funciona?"
                                           FontWeight="Bold"
                                           FontSize="14"
                                           Margin="0,0,0,5"/>
                                <TextBlock Text="Pega el correo con el detalle del procedimiento almacenado y deja que la IA analice los parÃ¡metros y genere automÃ¡ticamente las capas necesarias."
                                           TextWrapping="Wrap"
                                           FontSize="12"
                                           Foreground="#555"/>
                            </StackPanel>
                        </Border>

                        <!-- Panel de Contenido -->
                        <Grid Grid.Row="1">

                            <!-- ðŸ“¥ Panel Input -->
                            <Grid x:Name="panelInput" Visibility="Visible">
                              
                                    <StackPanel Margin="20" >
                                        <GroupBox Header="ðŸ“§ Correo TÃ©cnico"
                                                  Style="{StaticResource MaterialDesignCardGroupBox}">
                                            <StackPanel Margin="15">
                                                <TextBlock Text="Pegue aquÃ­ el correo con la definiciÃ³n del SP:"
                                                           Margin="0,0,0,10"
                                                           Foreground="#666"/>
                                                <TextBox x:Name="txtEmailContent"
                                                         TextWrapping="Wrap"
                                                         AcceptsReturn="True"
                                                         VerticalScrollBarVisibility="Auto"
                                                         MinHeight="300"
                                                         FontFamily="Consolas"
                                                         FontSize="12"
                                                         materialDesign:HintAssist.Hint="Ejemplo: El SP se llama sp_buscar_productos, recibe @codigo int, @nombre varchar(50)..."/>
                                                <Button x:Name="btnAnalyze"
                                                        Content="ðŸ” Analizar con IA"
                                                        Margin="0,15,0,0"
                                                        Click="btnAnalyze_Click"
                                                        Style="{StaticResource MaterialDesignRaisedButton}"
                                                        Height="40"/>
                                            </StackPanel>
                                        </GroupBox>
                                    </StackPanel>
                               
                            </Grid>

                            <!-- â³ Panel Analizando -->
                            <Grid x:Name="panelAnalyzing" Visibility="Collapsed">
                                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                                    <ProgressBar Style="{StaticResource MaterialDesignCircularProgressBar}"
                                                 IsIndeterminate="True"
                                                 Width="60"
                                                 Height="60"/>
                                    <TextBlock Text="ðŸ¤– Analizando con IA..."
                                               FontSize="16"
                                               Margin="0,20,0,0"
                                               HorizontalAlignment="Center"/>
                                    <TextBlock x:Name="txtAnalyzingStatus"
                                               Text="Extrayendo informaciÃ³n..."
                                               FontSize="12"
                                               Foreground="#666"
                                               Margin="0,10,0,0"
                                               HorizontalAlignment="Center"/>
                                </StackPanel>
                            </Grid>

                            <!-- ðŸ“„ Panel Resultados -->
                            <ScrollViewer x:Name="panelResult"
                                          Visibility="Collapsed"
                                          VerticalScrollBarVisibility="Auto">
                                <StackPanel Margin="20">
                                    <GroupBox Header="ðŸ“¦ Resultado del AnÃ¡lisis"
                                              Style="{StaticResource MaterialDesignCardGroupBox}">

                                        <StackPanel Margin="10">
                                            <TextBlock Text="âœ… AnÃ¡lisis Completado" Foreground="White" FontSize="16" FontWeight="Bold"/>
                                            <TextBlock Text="Revise y edite los campos generados antes de confirmar" Foreground="White" FontSize="12" Margin="0,5,0,0"/>
                                            <!-- SecciÃ³n 1: Stored Procedure -->
                                            <Expander Header="ðŸ—„ï¸ Stored Procedure" IsExpanded="True" Margin="0,0,0,10" Style="{StaticResource MaterialDesignExpander}">
                                                <StackPanel Margin="15">
                                                    <TextBox x:Name="txtSPName" materialDesign:HintAssist.Hint="Nombre del SP" Margin="0,0,0,10" FontFamily="Consolas"/>
                                                    <TextBlock Text="Ejemplo: sp_buscar_productos, pr_listar_clientes" FontSize="10" Foreground="#999" Margin="0,0,0,5"/>
                                                </StackPanel>
                                            </Expander>
                                            <!-- SecciÃ³n 2: Request (ParÃ¡metros de entrada) -->
                                            <Expander Header="ðŸ“¥ Request - ParÃ¡metros de Entrada" IsExpanded="True" Margin="0,0,0,10" Style="{StaticResource MaterialDesignExpander}">
                                                <StackPanel Margin="15">
                                                    <TextBlock Text="Formato: tipo nombre (uno por lÃ­nea)" FontSize="10" Foreground="#999" Margin="0,0,0,5"/>
                                                    <TextBox x:Name="txtRequestParams" TextWrapping="Wrap" AcceptsReturn="True" MinHeight="120" FontFamily="Consolas" FontSize="12" materialDesign:HintAssist.Hint="Ejemplo:&#x0a;int Codigo&#x0a;string Nombre&#x0a;DateTime? FechaInicio"/>
                                                </StackPanel>
                                            </Expander>
                                            <!-- SecciÃ³n 3: Parameters (ParÃ¡metros de entrada) -->
                                            <Expander Header="ðŸ“¥ Parseo ParÃ¡metros de Entrada" IsExpanded="True" Margin="0,0,0,10" Style="{StaticResource MaterialDesignExpander}">
                                                <StackPanel Margin="15">
                                                    <TextBlock Text="Formato: tipo nombre (uno por lÃ­nea)" FontSize="10" Foreground="#999" Margin="0,0,0,5"/>
                                                    <TextBox x:Name="txtParameters" TextWrapping="Wrap" AcceptsReturn="True" MinHeight="120" FontFamily="Consolas" FontSize="12" materialDesign:HintAssist.Hint="Ejemplo:&#x0a;int Codigo&#x0a;string Nombre&#x0a;DateTime? FechaInicio"/>
                                                </StackPanel>
                                            </Expander>
                                            <!-- SecciÃ³n 4: DTO (Estructura de base de datos) -->
                                            <Expander Header="ðŸ’¾ DTO - Campos del SP" IsExpanded="True" Margin="0,0,0,10" Style="{StaticResource MaterialDesignExpander}">
                                                <StackPanel Margin="15">
                                                    <TextBlock Text="Campos que retorna la base de datos" FontSize="10" Foreground="#999" Margin="0,0,0,5"/>
                                                    <TextBox x:Name="txtDTOFields" TextWrapping="Wrap" AcceptsReturn="True" MinHeight="150" FontFamily="Consolas" FontSize="12" materialDesign:HintAssist.Hint="Ejemplo:&#x0a;int pro_codigo&#x0a;string pro_nombre&#x0a;decimal pro_precio"/>
                                                </StackPanel>
                                            </Expander>
                                            <!-- SecciÃ³n 4: Response Mapper -->
                                            <Expander Header="ðŸ“¤ Response - Mapeo de Salida" IsExpanded="True" Margin="0,0,0,10" Style="{StaticResource MaterialDesignExpander}">
                                                <StackPanel Margin="15">
                                                    <TextBlock Text="Mapeo: campoDTO â†’ propiedadAPI (formato JSON)" FontSize="10" Foreground="#999" Margin="0,0,0,5"/>
                                                    <TextBox x:Name="txtResponseMapper" TextWrapping="Wrap" AcceptsReturn="True" MinHeight="150" FontFamily="Consolas" FontSize="12" materialDesign:HintAssist.Hint="Ejemplo (objeto anÃ³nimo):&#x0a;codigo = dto.pro_codigo,&#x0a;nombre = dto.pro_nombre,&#x0a;precio = dto.pro_precio"/>
                                                </StackPanel>
                                            </Expander>
                                        </StackPanel>
                                    </GroupBox>

                                
                                </StackPanel>
                            </ScrollViewer>
                        </Grid>
                    </Grid>
                </StackPanel>
            </Grid>
        </ScrollViewer>

        <!-- ðŸ¦¶ FOOTER -->
        <StackPanel Grid.Row="2"
                    Orientation="Horizontal"
                    HorizontalAlignment="Right"
                    Margin="0,15,0,0">
            <Button x:Name="btnCancelar"
                    Content="Cancelar"
                    Width="110"
                    Margin="0,0,10,0"
                    Click="btnCancelar_Click"
                    Style="{StaticResource MaterialDesignFlatButton}"/>
            <Button x:Name="btnVolverAnalizar" Content="â†©ï¸ Volver a Analizar" 
                    Click="btnBackToInput_Click" 
                    Style="{StaticResource MaterialDesignFlatButton}" 
                    Margin="0,0,10,0" Visibility="Collapsed"/>

            <Button x:Name="btnCrear"
                    Content="Crear MÃ©todo"
                    Width="140"
                    Click="btnCrear_Click"
                    Style="{StaticResource MaterialDesignRaisedButton}"/>
        </StackPanel>
    </Grid>
</Window>
